<head>
 <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.css" />
  <script src="http://cdn.leafletjs.com/leaflet-0.6.2/leaflet.js"></script>
	<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>


</head>

	<% first_username = @good_tracks[0].user.username %>
	<% first_track = @good_tracks[0] %>
	<% user_location = @good_users[0].city + ", " + @good_users[0].country %>

<% @geolocation = [] %>
	<% @city = Geocoder.search(user_location) %>
	<% lat = @city.first.data["geometry"]["location"]["lat"] %>
	<% lng = @city.first.data["geometry"]["location"]["lng"] %>
	<% @geolocation <<  lat %> 
	<% @geolocation << lng %>
<%= @geolocation %>

<div class="track">

			<strong> <%= first_username %> </strong> <%= user_location %>
			<br>
			<em> <%= first_track.title %> </em> 

			<div class="widget">
				<iframe id="sc-widget" src="https://w.soundcloud.com/player/?auto_play=true&url=http://api.soundcloud.com/tracks/<%= first_track.id %>" width="100%" height="20%" scrolling="no" frameborder="no"></iframe>
				<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
				<script type="text/javascript">
				  (function(){
				    var widgetIframe = document.getElementById('sc-widget'),
				        widget       = SC.Widget(widgetIframe);

				    widget.bind(SC.Widget.Events.READY, function() {
				      widget.bind(SC.Widget.Events.PLAY, function() {
				        // get information about currently playing sound
				        widget.getCurrentSound(function(currentSound) { 
				          console.log('sound ' + currentSound.get('') + 'began to play');
				        });
				      });
				      // get current level of volume
				      widget.getVolume(function(volume) {
				        console.log('current volume value is ' + volume);
				      });
				      // set new volume level
				      widget.setVolume(50);
				      // get the value of the current position
				    });

				  }());
				</script>
			</div>
</div>



 <div id="map">
 	
 	<script>
		var map = L.map('map').setView(<%= @geolocation %>, 5);
		var marker = L.marker(<%= @geolocation %>).addTo(map);

		L.tileLayer('http://{s}.tile.cloudmade.com/f644205df10c4e16a94c5c9b74438873/997/256/{z}/{x}/{y}.png', {
		    attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>',
		    maxZoom: 18
		}).addTo(map);

 	</script>

 </div>





<%# @users.each do |user| %>
	<%# if (user.city) and (user.city.length != 0)  %>
 <%#<li> # link_to user.city.titleize, "/city?user=#{user.id}&city=#{user.city}&username=#{user.username}" %> 
  <%# end%>
 <%# end %>
